<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WonDicab - æ™ºèƒ½å–®è©å­¸ç¿’</title>
    <style>
        :root {
            --bg-primary: #667eea;
            --bg-secondary: #764ba2;
            --bg-page: #f5f5f5;
            --bg-card: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --border-color: #e0e0e0;
            --shadow: rgba(0,0,0,0.05);
            --shadow-strong: rgba(0,0,0,0.1);
            --input-bg: #ffffff;
            --modal-bg: rgba(0,0,0,0.5);
        }

        [data-theme="dark"] {
            --bg-primary: #667eea;
            --bg-secondary: #764ba2;
            --bg-page: #1a1a1a;
            --bg-card: #2d2d2d;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-tertiary: #808080;
            --border-color: #404040;
            --shadow: rgba(0,0,0,0.3);
            --shadow-strong: rgba(0,0,0,0.5);
            --input-bg: #3d3d3d;
            --modal-bg: rgba(0,0,0,0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            min-height: 100vh;
            overflow: hidden;
            transition: background 0.3s ease;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            height: 100vh;
            background: var(--bg-page);
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 50px var(--shadow-strong);
            position: relative;
            transition: background 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px var(--shadow-strong);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            max-width: 428px;
            margin: 0 auto;
            z-index: 100;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .header-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sync-indicator {
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .sync-indicator.synced {
            color: #4caf50;
        }

        .sync-indicator.unsynced {
            color: #ff9800;
        }

        .page {
            display: none;
            flex: 1;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
            padding-top: 60px;
            padding-bottom: 80px;
            -webkit-overflow-scrolling: touch;
        }

        .page.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .bottom-nav {
            background: var(--bg-card);
            display: flex;
            justify-content: space-around;
            padding: 10px 0 max(10px, env(safe-area-inset-bottom));
            box-shadow: 0 -2px 10px var(--shadow-strong);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 428px;
            margin: 0 auto;
            z-index: 100;
            transition: background 0.3s ease;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            cursor: pointer;
            color: var(--text-tertiary);
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        .nav-item.active {
            color: var(--bg-primary);
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .nav-text {
            font-size: 12px;
        }

        .content {
            padding: 20px;
            flex: 1;
        }

        .card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px var(--shadow);
            transition: background 0.3s ease;
        }

        .card h2 {
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--bg-primary);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }

        .search-box {
            position: sticky;
            top: 0;
            background: var(--bg-page);
            padding: 15px 20px;
            margin: -20px -20px 15px -20px;
            z-index: 10;
        }

        .search-input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            font-size: 16px;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--bg-primary);
        }

        .search-clear {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 20px;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 5px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: white;
        }

        .btn-secondary {
            background: var(--border-color);
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .btn-primary:active,
        .btn-secondary:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .url-input-group {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .url-input-group .form-input {
            flex: 1;
        }

        .btn-fetch {
            padding: 12px 20px;
            background: var(--bg-primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #1565c0;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #e65100;
        }

        .toggle-section {
            text-align: center;
            margin: 15px 0;
        }

        .toggle-btn {
            background: none;
            border: none;
            color: var(--bg-primary);
            font-size: 14px;
            cursor: pointer;
            text-decoration: underline;
            padding: 5px;
        }

        .word-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px var(--shadow);
            cursor: pointer;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        .word-item:active {
            transform: scale(0.98);
        }

        .word-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .speak-btn {
            background: #e8eaf6;
            border: none;
            color: var(--bg-primary);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .speak-btn:hover {
            background: var(--bg-primary);
            color: white;
        }

        .speak-btn:active {
            transform: scale(0.9);
        }

        .word-pos {
            display: inline-block;
            font-size: 12px;
            color: var(--bg-primary);
            background: #e8eaf6;
            padding: 2px 8px;
            border-radius: 4px;
            margin-right: 8px;
            margin-bottom: 5px;
        }

        .word-meaning {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .word-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }

        .word-level {
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 500;
        }

        .level-new {
            background: #e3f2fd;
            color: #1976d2;
        }

        .level-hard {
            background: #ffebee;
            color: #c62828;
        }

        .level-medium {
            background: #fff3e0;
            color: #ef6c00;
        }

        .level-easy {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .word-next-review {
            color: var(--text-tertiary);
        }

        .review-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .review-word {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .review-speak-btn {
            background: #e8eaf6;
            border: none;
            color: var(--bg-primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .review-meaning {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .review-example {
            font-size: 14px;
            color: var(--text-tertiary);
            font-style: italic;
            line-height: 1.8;
            white-space: pre-line;
            text-align: left;
            background: var(--input-bg);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .review-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .review-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-hard {
            background: #ffebee;
            color: #c62828;
        }

        .btn-medium {
            background: #fff3e0;
            color: #ef6c00;
        }

        .btn-easy {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--bg-primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-tertiary);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-tertiary);
        }

        .empty-state h3 {
            color: var(--text-primary);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .show-answer-btn {
            width: 100%;
            padding: 15px;
            background: var(--bg-primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            -webkit-tap-highlight-color: transparent;
        }

        .mode-switch {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .mode-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-primary);
        }

        .mode-btn.active {
            background: var(--bg-primary);
            color: white;
            border-color: var(--bg-primary);
        }

        .hidden {
            display: none;
        }

        .sync-status {
            font-size: 12px;
            color: #4caf50;
            margin-top: 10px;
            text-align: center;
        }

        .error-status {
            font-size: 12px;
            color: #f44336;
            margin-top: 10px;
            text-align: center;
        }

        .word-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--modal-bg);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .word-detail-modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .modal-content h2 {
            color: var(--text-primary);
        }

        .modal-content .form-group > div {
            color: var(--text-primary);
        }

        .modal-close {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-tertiary);
            -webkit-tap-highlight-color: transparent;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-actions .btn {
            flex: 1;
        }

        .edit-btn {
            background: var(--bg-primary);
            color: white;
        }

        .delete-btn {
            background: #ffebee;
            color: #c62828;
        }

        .cancel-btn {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .save-btn {
            background: #4caf50;
            color: white;
        }

        .last-sync {
            font-size: 11px;
            color: var(--text-tertiary);
            text-align: center;
            margin-top: 5px;
        }

        @supports (padding: max(0px)) {
            .app-container {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1 id="headerTitle">WonDicab</h1>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">ğŸŒ™</button>
                <div class="sync-indicator" id="syncIndicator">
                    <span id="syncIcon">âš ï¸</span>
                </div>
                <button class="header-btn" id="syncBtn" data-i18n="sync">åŒæ­¥</button>
            </div>
        </div>

        <!-- ä¸»é¡µ -->
        <div class="page active" id="homePage">
            <div class="content">
                <div class="card">
                    <h2 style="margin-bottom: 15px;" data-i18n="todayReview">ğŸ“š ä»Šæ—¥å¾©ç¿’</h2>
                    
                    <div class="mode-switch">
                        <button class="mode-btn active" data-mode="order" onclick="setReviewMode('order')" data-i18n="orderMode">é †åº</button>
                        <button class="mode-btn" data-mode="random" onclick="setReviewMode('random')" data-i18n="randomMode">éš¨æ©Ÿ</button>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="todayReviewCount">0</div>
                            <div class="stat-label" data-i18n="toReview">å¾…å¾©ç¿’</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalWordCount">0</div>
                            <div class="stat-label" data-i18n="totalWords">ç¸½å–®è©</div>
                        </div>
                    </div>
                </div>
                <div id="reviewContainer"></div>
            </div>
        </div>

        <!-- æ·»åŠ é¡µé¢ -->
        <div class="page" id="addPage">
            <div class="content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;" data-i18n="addNewWord">â• æ·»åŠ æ–°å–®è©</h2>
                    
                    <div id="urlImportSection">
                        <div class="info-box" data-i18n="urlImportTip">
                            ğŸ’¡ ç²˜è²¼åŠæ©‹è©å…¸URLï¼Œè‡ªå‹•ç²å–å–®è©ä¿¡æ¯
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" data-i18n="cambridgeUrl">åŠæ©‹è©å…¸URL</label>
                            <div class="url-input-group">
                                <input type="url" class="form-input" id="dictUrlInput" 
                                       placeholder="https://dictionary.cambridge.org/...">
                                <button class="btn-fetch" id="fetchBtn" onclick="fetchFromCambridge()" data-i18n="fetch">
                                    ç²å–
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="toggle-section">
                        <button class="toggle-btn" onclick="toggleImportMethod()" data-i18n="pasteHtmlToggle">
                            æˆ–è€…ç²˜è²¼ç¶²é HTMLå…§å®¹ â†’
                        </button>
                    </div>

                    <div id="htmlImportSection" class="hidden">
                        <div class="warning-box" data-i18n="htmlImportInstructions">
                            âš ï¸ å¦‚æœURLç²å–å¤±æ•—ï¼Œå¯ä»¥ï¼š<br>
                            1. åœ¨åŠæ©‹è©å…¸é é¢æŒ‰ Ctrl+A (å…¨é¸)<br>
                            2. æŒ‰ Ctrl+C (è¤‡è£½)<br>
                            3. ç²˜è²¼åˆ°ä¸‹é¢çš„æ¡†ä¸­
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" data-i18n="pasteWebContent">ç²˜è²¼ç¶²é å…§å®¹</label>
                            <textarea class="form-textarea" id="htmlInput" 
                                      placeholder="ç²˜è²¼åŠæ©‹è©å…¸é é¢å…§å®¹..."
                                      style="min-height: 120px;"></textarea>
                        </div>
                        <button class="btn btn-secondary" onclick="parseFromHTML()" data-i18n="parseContent">
                            è§£æå…§å®¹
                        </button>
                    </div>

                    <div style="text-align: center; color: var(--text-tertiary); margin: 15px 0; font-size: 14px;" data-i18n="orManualInput">
                        æˆ–æ‰‹å‹•è¼¸å…¥
                    </div>

                    <form id="addWordForm">
                        <div class="form-group">
                            <label class="form-label" data-i18n="englishWord">è‹±æ–‡å–®è©</label>
                            <input type="text" class="form-input" id="wordInput" required placeholder="ä¾‹: apple">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="partOfSpeech">è©æ€§ (å¯é¸)</label>
                            <input type="text" class="form-input" id="posInput" placeholder="ä¾‹: noun, verb">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="chineseMeaning">ä¸­æ–‡æ„æ€</label>
                            <input type="text" class="form-input" id="meaningInput" required placeholder="ä¾‹: è˜‹æœ">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="englishMeaning">è‹±æ–‡æ„æ€ (å¯é¸)</label>
                            <input type="text" class="form-input" id="enMeaningInput" placeholder="ä¾‹: a round fruit">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="examples">ä¾‹å¥ (å¯é¸ï¼Œå¤šå€‹ä¾‹å¥ç”¨æ›è¡Œåˆ†éš”)</label>
                            <textarea class="form-textarea" id="exampleInput" 
                                      placeholder="ä¾‹: I eat an apple every day.&#10;Apples are healthy."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" data-i18n="addWord">æ·»åŠ å–®è©</button>
                    </form>
                    <div class="sync-status hidden" id="addStatus"></div>
                    <div class="error-status hidden" id="addError"></div>
                </div>
            </div>
        </div>

        <!-- å•è¯åº“é¡µé¢ -->
        <div class="page" id="libraryPage">
            <div class="content">
                <div class="search-box" style="position: relative;">
                    <input type="text" class="search-input" id="searchInput" 
                           placeholder="æœç´¢å–®è©..." 
                           oninput="searchWords()">
                    <button class="search-clear hidden" id="searchClear" onclick="clearSearch()">âœ•</button>
                </div>
                <div id="wordList"></div>
            </div>
        </div>

        <!-- è®¾ç½®é¡µé¢ -->
        <div class="page" id="settingsPage">
            <div class="content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;" data-i18n="languageSettings">ğŸŒ èªè¨€è¨­ç½®</h2>
                    <div class="form-group">
                        <label class="form-label" data-i18n="selectLanguage">é¸æ“‡èªè¨€</label>
                        <select class="form-select" id="languageSelect" onchange="changeLanguage()">
                            <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;" data-i18n="syncSettings">âš™ï¸ æ•¸æ“šåŒæ­¥è¨­ç½®</h2>
                    <div class="form-group">
                        <label class="form-label" data-i18n="userId">ç”¨æˆ¶ ID</label>
                        <input type="text" class="form-input" id="userIdInput" placeholder="æ‚¨çš„å”¯ä¸€æ¨™è­˜">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="githubToken">GitHub Token</label>
                        <input type="password" class="form-input" id="tokenInput" placeholder="GitHub Personal Access Token">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="repoName">å€‰åº«åç¨±</label>
                        <input type="text" class="form-input" id="repoInput" placeholder="ç”¨æˆ¶å/å€‰åº«å">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="folderPath">æ–‡ä»¶å¤¾è·¯å¾‘ (å¯é¸)</label>
                        <input type="text" class="form-input" id="folderInput" placeholder="ä¾‹: wondicab">
                        <small style="color: var(--text-tertiary); font-size: 12px;">ç•™ç©ºå‰‡ä¿å­˜åˆ°å€‰åº«æ ¹ç›®éŒ„</small>
                    </div>
                    <button class="btn btn-primary" id="saveSettingsBtn" data-i18n="saveSettings">ä¿å­˜è¨­ç½®</button>
                    <button class="btn btn-primary" style="margin-top: 10px;" id="downloadDataBtn" data-i18n="downloadData">ä¸‹è¼‰æ•¸æ“š</button>
                    <button class="btn btn-secondary" style="margin-top: 10px;" id="exportCsvBtn" data-i18n="exportCsv">å°å‡ºCSV</button>
                    <div class="sync-status hidden" id="settingsStatus"></div>
                    <div class="last-sync" id="lastSyncTime"></div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px;" data-i18n="learningStats">ğŸ“Š å­¸ç¿’çµ±è¨ˆ</h2>
                    <div class="setting-item">
                        <span data-i18n="unfamiliar">ä¸ç†Ÿæ‚‰</span>
                        <span id="hardCount">0</span>
                    </div>
                    <div class="setting-item">
                        <span data-i18n="medium">ä¸­ç­‰</span>
                        <span id="mediumCount">0</span>
                    </div>
                    <div class="setting-item">
                        <span data-i18n="familiar">ç†Ÿæ‚‰</span>
                        <span id="easyCount">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="bottom-nav">
            <div class="nav-item active" data-page="homePage">
                <div class="nav-icon">ğŸ </div>
                <div class="nav-text" data-i18n="navReview">å¾©ç¿’</div>
            </div>
            <div class="nav-item" data-page="addPage">
                <div class="nav-icon">â•</div>
                <div class="nav-text" data-i18n="navAdd">æ·»åŠ </div>
            </div>
            <div class="nav-item" data-page="libraryPage">
                <div class="nav-icon">ğŸ“š</div>
                <div class="nav-text" data-i18n="navLibrary">å–®è©åº«</div>
            </div>
            <div class="nav-item" data-page="settingsPage">
                <div class="nav-icon">âš™ï¸</div>
                <div class="nav-text" data-i18n="navSettings">è¨­ç½®</div>
            </div>
        </div>
    </div>

    <div class="word-detail-modal" id="wordDetailModal">
        <div class="modal-content">
            <span class="modal-close" id="closeModal">âœ•</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        const translations = {
            'zh-TW': {
                todayReview: 'ğŸ“š ä»Šæ—¥å¾©ç¿’',
                addNewWord: 'â• æ·»åŠ æ–°å–®è©',
                library: 'ğŸ“š å–®è©åº«',
                settings: 'âš™ï¸ è¨­ç½®',
                navReview: 'å¾©ç¿’',
                navAdd: 'æ·»åŠ ',
                navLibrary: 'å–®è©åº«',
                navSettings: 'è¨­ç½®',
                sync: 'åŒæ­¥',
                fetch: 'ç²å–',
                addWord: 'æ·»åŠ å–®è©',
                saveSettings: 'ä¿å­˜è¨­ç½®',
                downloadData: 'ä¸‹è¼‰æ•¸æ“š',
                exportCsv: 'å°å‡ºCSV',
                parseContent: 'è§£æå…§å®¹',
                showAnswer: 'é¡¯ç¤ºç­”æ¡ˆ',
                deleteWord: 'åˆªé™¤å–®è©',
                editWord: 'ç·¨è¼¯å–®è©',
                save: 'ä¿å­˜',
                cancel: 'å–æ¶ˆ',
                toReview: 'å¾…å¾©ç¿’',
                totalWords: 'ç¸½å–®è©',
                orderMode: 'é †åº',
                randomMode: 'éš¨æ©Ÿ',
                cambridgeUrl: 'åŠæ©‹è©å…¸URL',
                englishWord: 'è‹±æ–‡å–®è©',
                partOfSpeech: 'è©æ€§ (å¯é¸)',
                chineseMeaning: 'ä¸­æ–‡æ„æ€',
                englishMeaning: 'è‹±æ–‡æ„æ€ (å¯é¸)',
                examples: 'ä¾‹å¥ (å¯é¸ï¼Œå¤šå€‹ä¾‹å¥ç”¨æ›è¡Œåˆ†éš”)',
                userId: 'ç”¨æˆ¶ ID',
                githubToken: 'GitHub Token',
                repoName: 'å€‰åº«åç¨±',
                folderPath: 'æ–‡ä»¶å¤¾è·¯å¾‘ (å¯é¸)',
                urlImportTip: 'ğŸ’¡ ç²˜è²¼åŠæ©‹è©å…¸URLï¼Œè‡ªå‹•ç²å–å–®è©ä¿¡æ¯',
                pasteHtmlToggle: 'æˆ–è€…ç²˜è²¼ç¶²é HTMLå…§å®¹ â†’',
                htmlImportInstructions: 'âš ï¸ å¦‚æœURLç²å–å¤±æ•—ï¼Œå¯ä»¥ï¼š<br>1. åœ¨åŠæ©‹è©å…¸é é¢æŒ‰ Ctrl+A (å…¨é¸)<br>2. æŒ‰ Ctrl+C (è¤‡è£½)<br>3. ç²˜è²¼åˆ°ä¸‹é¢çš„æ¡†ä¸­',
                orManualInput: 'æˆ–æ‰‹å‹•è¼¸å…¥',
                pasteWebContent: 'ç²˜è²¼ç¶²é å…§å®¹',
                languageSettings: 'ğŸŒ èªè¨€è¨­ç½®',
                selectLanguage: 'é¸æ“‡èªè¨€',
                syncSettings: 'âš™ï¸ æ•¸æ“šåŒæ­¥è¨­ç½®',
                learningStats: 'ğŸ“Š å­¸ç¿’çµ±è¨ˆ',
                unfamiliar: 'ä¸ç†Ÿæ‚‰',
                medium: 'ä¸­ç­‰',
                familiar: 'ç†Ÿæ‚‰',
                newWord: 'æ–°å–®è©',
                chinese: 'ä¸­æ–‡',
                english: 'è‹±æ–‡',
                statistics: 'çµ±è¨ˆ',
                reviewCount: 'å¾©ç¿’æ¬¡æ•¸',
                proficiency: 'ç†Ÿæ‚‰ç¨‹åº¦',
                nextReview: 'ä¸‹æ¬¡å¾©ç¿’',
                noReviewToday: 'ä»Šå¤©æ²’æœ‰éœ€è¦å¾©ç¿’çš„å–®è©',
                reviewComplete: 'å¾©ç¿’å®Œæˆï¼',
                reviewCompleteDesc: 'ä»Šå¤©çš„å¾©ç¿’ä»»å‹™å·²å®Œæˆ',
                noWords: 'é‚„æ²’æœ‰å–®è©',
                noWordsDesc: 'é»æ“Š"æ·»åŠ "é–‹å§‹å­¸ç¿’å§',
                great: 'å¤ªæ£’äº†ï¼',
                notFamiliar: 'ğŸ˜° ä¸ç†Ÿ',
                somewhatFamiliar: 'ğŸ¤” ä¸­ç­‰',
                veryFamiliar: 'ğŸ˜Š ç†Ÿæ‚‰',
                wordAdded: 'âœ… å–®è©æ·»åŠ æˆåŠŸï¼',
                wordUpdated: 'âœ… å–®è©æ›´æ–°æˆåŠŸï¼',
                fetchSuccess: 'âœ… æˆåŠŸç²å–å–®è©ä¿¡æ¯ï¼',
                settingsSaved: 'âœ… è¨­ç½®å·²ä¿å­˜',
                syncSuccess: 'âœ… åŒæ­¥æˆåŠŸï¼',
                downloadSuccess: 'âœ… æ•¸æ“šä¸‹è¼‰æˆåŠŸï¼',
                parseSuccess: 'âœ… æˆåŠŸè§£æå–®è©ä¿¡æ¯ï¼',
                csvExported: 'âœ… CSVæ–‡ä»¶å·²ä¸‹è¼‰ï¼',
                enterUrl: 'è«‹è¼¸å…¥åŠæ©‹è©å…¸URL',
                invalidUrl: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„åŠæ©‹è©å…¸URL',
                fetchFailed: 'âŒ æ‰€æœ‰ä»£ç†éƒ½å¤±æ•—äº†ï¼Œè«‹å˜—è©¦"ç²˜è²¼HTMLå…§å®¹"æ–¹å¼',
                enterHtml: 'è«‹ç²˜è²¼ç¶²é å…§å®¹',
                parseFailed: 'âŒ ç„¡æ³•è§£æå–®è©ä¿¡æ¯ï¼Œè«‹æª¢æŸ¥ç²˜è²¼çš„å…§å®¹',
                syncFailed: 'âŒ åŒæ­¥å¤±æ•—: ',
                downloadFailed: 'âŒ ä¸‹è¼‰å¤±æ•—: ',
                configureGithub: 'è«‹å…ˆåœ¨è¨­ç½®ä¸­é…ç½® GitHub ä¿¡æ¯',
                configureGithubFirst: 'è«‹å…ˆé…ç½® GitHub ä¿¡æ¯',
                downloadNotFound: 'æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ¬Šé™ä¸è¶³',
                confirmDelete: 'ç¢ºå®šè¦åˆªé™¤é€™å€‹å–®è©å—ï¼Ÿ',
                synced: 'å·²åŒæ­¥',
                unsynced: 'æœªåŒæ­¥',
                lastSync: 'æœ€å¾ŒåŒæ­¥',
                never: 'å¾æœª'
            },
            'en': {
                todayReview: 'ğŸ“š Today\'s Review',
                addNewWord: 'â• Add New Word',
                library: 'ğŸ“š Word Library',
                settings: 'âš™ï¸ Settings',
                navReview: 'Review',
                navAdd: 'Add',
                navLibrary: 'Library',
                navSettings: 'Settings',
                sync: 'Sync',
                fetch: 'Fetch',
                addWord: 'Add Word',
                saveSettings: 'Save Settings',
                downloadData: 'Download Data',
                exportCsv: 'Export CSV',
                parseContent: 'Parse Content',
                showAnswer: 'Show Answer',
                deleteWord: 'Delete Word',
                editWord: 'Edit Word',
                save: 'Save',
                cancel: 'Cancel',
                toReview: 'To Review',
                totalWords: 'Total Words',
                orderMode: 'Order',
                randomMode: 'Random',
                cambridgeUrl: 'Cambridge Dictionary URL',
                englishWord: 'English Word',
                partOfSpeech: 'Part of Speech (Optional)',
                chineseMeaning: 'Chinese Meaning',
                englishMeaning: 'English Meaning (Optional)',
                examples: 'Examples (Optional, separate with line breaks)',
                userId: 'User ID',
                githubToken: 'GitHub Token',
                repoName: 'Repository Name',
                folderPath: 'Folder Path (Optional)',
                urlImportTip: 'ğŸ’¡ Paste Cambridge Dictionary URL to auto-fetch word info',
                pasteHtmlToggle: 'Or paste webpage HTML content â†’',
                htmlImportInstructions: 'âš ï¸ If URL fetch fails, you can:<br>1. Press Ctrl+A on Cambridge Dictionary page<br>2. Press Ctrl+C to copy<br>3. Paste into the box below',
                orManualInput: 'Or enter manually',
                pasteWebContent: 'Paste Web Content',
                languageSettings: 'ğŸŒ Language Settings',
                selectLanguage: 'Select Language',
                syncSettings: 'âš™ï¸ Data Sync Settings',
                learningStats: 'ğŸ“Š Learning Statistics',
                unfamiliar: 'Unfamiliar',
                medium: 'Medium',
                familiar: 'Familiar',
                newWord: 'New Word',
                chinese: 'Chinese',
                english: 'English',
                statistics: 'Statistics',
                reviewCount: 'Review Count',
                proficiency: 'Proficiency',
                nextReview: 'Next Review',
                noReviewToday: 'No words to review today',
                reviewComplete: 'Review Complete!',
                reviewCompleteDesc: 'Today\'s review task is complete',
                noWords: 'No words yet',
                noWordsDesc: 'Click "Add" to start learning',
                great: 'Great!',
                notFamiliar: 'ğŸ˜° Hard',
                somewhatFamiliar: 'ğŸ¤” Medium',
                veryFamiliar: 'ğŸ˜Š Easy',
                wordAdded: 'âœ… Word added successfully!',
                wordUpdated: 'âœ… Word updated successfully!',
                fetchSuccess: 'âœ… Word info fetched successfully!',
                settingsSaved: 'âœ… Settings saved',
                syncSuccess: 'âœ… Sync successful!',
                downloadSuccess: 'âœ… Data downloaded successfully!',
                parseSuccess: 'âœ… Word info parsed successfully!',
                csvExported: 'âœ… CSV file downloaded!',
                enterUrl: 'Please enter Cambridge Dictionary URL',
                invalidUrl: 'Please enter a valid Cambridge Dictionary URL',
                fetchFailed: 'âŒ All proxies failed, please try "Paste HTML Content" method',
                enterHtml: 'Please paste web content',
                parseFailed: 'âŒ Unable to parse word info, please check the pasted content',
                syncFailed: 'âŒ Sync failed: ',
                downloadFailed: 'âŒ Download failed: ',
                configureGithub: 'Please configure GitHub info in settings first',
                configureGithubFirst: 'Please configure GitHub info first',
                downloadNotFound: 'File not found or permission denied',
                confirmDelete: 'Are you sure you want to delete this word?',
                synced: 'Synced',
                unsynced: 'Not synced',
                lastSync: 'Last sync',
                never: 'Never'
            }
        };

        let appState = {
            words: [],
            settings: {
                userId: '',
                token: '',
                repo: '',
                folder: '',
                language: 'zh-TW',
                theme: 'light',
                lastSync: null
            },
            currentReviewIndex: 0,
            todayReviews: [],
            reviewMode: 'order',
            searchQuery: ''
        };

        const REVIEW_INTERVALS = {
            hard: 1,
            medium: 3,
            easy: 7
        };

        const CORS_PROXIES = [
            'https://api.allorigins.win/raw?url=',
            'https://corsproxy.io/?',
            'https://api.codetabs.com/v1/proxy?quest='
        ];

        let currentLang = 'zh-TW';
        let editingWordId = null;

        function toggleTheme() {
            const currentTheme = appState.settings.theme;
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            appState.settings.theme = newTheme;
            applyTheme(newTheme);
            saveLocalData();
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const themeBtn = document.getElementById('themeToggle');
            themeBtn.textContent = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        function changeLanguage() {
            const lang = document.getElementById('languageSelect').value;
            currentLang = lang;
            appState.settings.language = lang;
            saveLocalData();
            applyTranslations();
            
            const currentPage = document.querySelector('.page.active').id;
            if (currentPage === 'homePage') {
                updateReviewPage();
            } else if (currentPage === 'libraryPage') {
                updateLibraryPage();
            }
        }

        function t(key) {
            return translations[currentLang][key] || key;
        }

        function applyTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(elem => {
                const key = elem.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    if (elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA') {
                    } else {
                        elem.innerHTML = translations[currentLang][key];
                    }
                }
            });

            document.title = currentLang === 'zh-TW' ? 'WonDicab - æ™ºèƒ½å–®è©å­¸ç¿’' : 'WonDicab - Smart Word Learning';
            updateSyncIndicator();
            updateLastSyncTime();
        }

        function initApp() {
            loadLocalData();
            applyTheme(appState.settings.theme);
            setupEventListeners();
            applyTranslations();
            updateUI();
        }

        function loadLocalData() {
            const savedWords = localStorage.getItem('wondicab_words');
            const savedSettings = localStorage.getItem('wondicab_settings');
            
            if (savedWords) {
                appState.words = JSON.parse(savedWords);
            }
            
            if (savedSettings) {
                appState.settings = JSON.parse(savedSettings);
                document.getElementById('userIdInput').value = appState.settings.userId || '';
                document.getElementById('tokenInput').value = appState.settings.token || '';
                document.getElementById('repoInput').value = appState.settings.repo || '';
                document.getElementById('folderInput').value = appState.settings.folder || '';
                currentLang = appState.settings.language || 'zh-TW';
                document.getElementById('languageSelect').value = currentLang;
            }
        }

        function saveLocalData() {
            localStorage.setItem('wondicab_words', JSON.stringify(appState.words));
            localStorage.setItem('wondicab_settings', JSON.stringify(appState.settings));
            updateSyncIndicator();
        }

        function updateSyncIndicator() {
            const indicator = document.getElementById('syncIndicator');
            const icon = document.getElementById('syncIcon');
            
            if (appState.settings.lastSync) {
                indicator.className = 'sync-indicator synced';
                icon.textContent = 'âœ…';
            } else {
                indicator.className = 'sync-indicator unsynced';
                icon.textContent = 'âš ï¸';
            }
        }

        function updateLastSyncTime() {
            const lastSyncElem = document.getElementById('lastSyncTime');
            if (appState.settings.lastSync) {
                const date = new Date(appState.settings.lastSync);
                lastSyncElem.textContent = `${t('lastSync')}: ${date.toLocaleString()}`;
            } else {
                lastSyncElem.textContent = `${t('lastSync')}: ${t('never')}`;
            }
        }

        function speakWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                speechSynthesis.speak(utterance);
            }
        }

        function setReviewMode(mode) {
            appState.reviewMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            updateReviewPage();
        }

        function searchWords() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            appState.searchQuery = query;
            
            const clearBtn = document.getElementById('searchClear');
            if (query) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
            
            updateLibraryPage();
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            appState.searchQuery = '';
            document.getElementById('searchClear').classList.add('hidden');
            updateLibraryPage();
        }

        function exportToCSV() {
            if (appState.words.length === 0) {
                alert(currentLang === 'zh-TW' ? 'æ²’æœ‰å–®è©å¯ä»¥å°å‡º' : 'No words to export');
                return;
            }

            const headers = ['Word', 'Part of Speech', 'Chinese Meaning', 'English Meaning', 'Examples', 'Level', 'Review Count', 'Next Review'];
            const rows = appState.words.map(word => [
                word.word,
                word.pos || '',
                word.meaning,
                word.enMeaning || '',
                (word.example || '').replace(/\n/g, ' | '),
                word.level,
                word.reviewCount,
                word.nextReview
            ]);

            let csvContent = headers.join(',') + '\n';
            rows.forEach(row => {
                csvContent += row.map(field => `"${field}"`).join(',') + '\n';
            });

            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `wondicab_words_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showStatus('settingsStatus', t('csvExported'));
        }

        function toggleImportMethod() {
            const urlSection = document.getElementById('urlImportSection');
            const htmlSection = document.getElementById('htmlImportSection');
            
            if (htmlSection.classList.contains('hidden')) {
                htmlSection.classList.remove('hidden');
                urlSection.classList.add('hidden');
            } else {
                htmlSection.classList.add('hidden');
                urlSection.classList.remove('hidden');
            }
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const pageId = this.dataset.page;
                    switchPage(pageId);
                });
            });

            document.getElementById('addWordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addWord();
            });

            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
            document.getElementById('syncBtn').addEventListener('click', syncToGitHub);
            document.getElementById('downloadDataBtn').addEventListener('click', downloadFromGitHub);
            document.getElementById('exportCsvBtn').addEventListener('click', exportToCSV);
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('wordDetailModal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
        }

        async function fetchFromCambridge() {
            const urlInput = document.getElementById('dictUrlInput');
            const url = urlInput.value.trim();
            
            if (!url) {
                showError('addError', t('enterUrl'));
                return;
            }

            if (!url.includes('dictionary.cambridge.org')) {
                showError('addError', t('invalidUrl'));
                return;
            }

            const fetchBtn = document.getElementById('fetchBtn');
            fetchBtn.disabled = true;
            fetchBtn.innerHTML = '<span class="loading"></span>';

            for (let i = 0; i < CORS_PROXIES.length; i++) {
                try {
                    const proxyUrl = CORS_PROXIES[i];
                    const response = await fetch(proxyUrl + encodeURIComponent(url), {
                        method: 'GET',
                        headers: {
                            'Accept': 'text/html'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('HTTP error ' + response.status);
                    }

                    const html = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');

                    const wordData = extractWordData(doc);
                    
                    if (wordData.word) {
                        fillFormWithData(wordData);
                        showStatus('addStatus', t('fetchSuccess'));
                        urlInput.value = '';
                        fetchBtn.disabled = false;
                        fetchBtn.textContent = t('fetch');
                        return;
                    }

                } catch (error) {
                    console.log(`Proxy ${i + 1} failed:`, error);
                    if (i === CORS_PROXIES.length - 1) {
                        showError('addError', t('fetchFailed'));
                    }
                }
            }

            fetchBtn.disabled = false;
            fetchBtn.textContent = t('fetch');
        }

        function parseFromHTML() {
            const htmlInput = document.getElementById('htmlInput');
            const html = htmlInput.value.trim();
            
            if (!html) {
                showError('addError', t('enterHtml'));
                return;
            }

            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                const wordData = extractWordData(doc);
                
                if (wordData.word) {
                    fillFormWithData(wordData);
                    showStatus('addStatus', t('parseSuccess'));
                    htmlInput.value = '';
                    toggleImportMethod();
                } else {
                    showError('addError', t('parseFailed'));
                }
            } catch (error) {
                showError('addError', t('parseFailed'));
            }
        }

        function fillFormWithData(wordData) {
            document.getElementById('wordInput').value = wordData.word;
            document.getElementById('posInput').value = wordData.pos || '';
            document.getElementById('meaningInput').value = wordData.chineseMeaning || '';
            document.getElementById('enMeaningInput').value = wordData.englishMeaning || '';
            document.getElementById('exampleInput').value = wordData.examples || '';
        }

        function extractWordData(doc) {
            const data = {
                word: '',
                pos: '',
                englishMeaning: '',
                chineseMeaning: '',
                examples: ''
            };

            try {
                const wordElement = doc.querySelector('.hw.dhw') || 
                                  doc.querySelector('.headword') ||
                                  doc.querySelector('.di-title');
                if (wordElement) {
                    data.word = wordElement.textContent.trim();
                }

                const posElement = doc.querySelector('.pos.dpos') ||
                                 doc.querySelector('.posgram');
                if (posElement) {
                    data.pos = posElement.textContent.trim();
                }

                const defElement = doc.querySelector('.def.ddef_d.db') ||
                                 doc.querySelector('.def.ddef_d');
                if (defElement) {
                    data.englishMeaning = defElement.textContent.trim();
                }

                const transElement = doc.querySelector('.trans.dtrans.dtrans-se') ||
                                   doc.querySelector('.trans.dtrans');
                if (transElement) {
                    data.chineseMeaning = transElement.textContent.trim();
                }

                const exampleElements = doc.querySelectorAll('.eg.deg');
                const examples = [];
                exampleElements.forEach((elem, index) => {
                    if (index < 5) {
                        const exampleText = elem.textContent.trim();
                        if (exampleText) {
                            examples.push(exampleText);
                        }
                    }
                });
                
                if (examples.length > 0) {
                    data.examples = examples.join('\n');
                }

                if (!data.chineseMeaning) {
                    const altTransElements = doc.querySelectorAll('.def-body .trans');
                    if (altTransElements.length > 0) {
                        data.chineseMeaning = altTransElements[0].textContent.trim();
                    }
                }

            } catch (error) {
                console.error('Error extracting word data:', error);
            }

            return data;
        }

        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');

            const titles = {
                homePage: t('todayReview'),
                addPage: t('addNewWord'),
                libraryPage: t('library'),
                settingsPage: t('settings')
            };
            document.getElementById('headerTitle').textContent = titles[pageId] || 'WonDicab';

            if (pageId === 'homePage') {
                updateReviewPage();
            } else if (pageId === 'libraryPage') {
                updateLibraryPage();
            } else if (pageId === 'settingsPage') {
                updateStatsPage();
                updateLastSyncTime();
            }
        }

        function addWord() {
            const word = {
                id: Date.now(),
                word: document.getElementById('wordInput').value.trim(),
                pos: document.getElementById('posInput').value.trim(),
                meaning: document.getElementById('meaningInput').value.trim(),
                enMeaning: document.getElementById('enMeaningInput').value.trim(),
                example: document.getElementById('exampleInput').value.trim(),
                level: 'new',
                nextReview: new Date().toISOString().split('T')[0],
                createdAt: new Date().toISOString(),
                reviewCount: 0
            };

            appState.words.push(word);
            saveLocalData();
            
            showStatus('addStatus', t('wordAdded'));
            
            document.getElementById('addWordForm').reset();
            document.getElementById('dictUrlInput').value = '';
            
            updateUI();
        }

        function updateUI() {
            updateStats();
        }

        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayReviews = appState.words.filter(w => w.nextReview <= today);
            
            document.getElementById('todayReviewCount').textContent = todayReviews.length;
            document.getElementById('totalWordCount').textContent = appState.words.length;
        }

        function updateReviewPage() {
            const today = new Date().toISOString().split('T')[0];
            appState.todayReviews = appState.words.filter(w => w.nextReview <= today);
            
            if (appState.reviewMode === 'random') {
                appState.todayReviews = shuffleArray([...appState.todayReviews]);
            }
            
            appState.currentReviewIndex = 0;

            const container = document.getElementById('reviewContainer');
            
            if (appState.todayReviews.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ‰</div>
                        <h3>${t('great')}</h3>
                        <p>${t('noReviewToday')}</p>
                    </div>
                `;
                return;
            }

            showReviewCard();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function formatExamples(exampleText) {
            if (!exampleText) return '';
            const examples = exampleText.split('\n').filter(e => e.trim());
            if (examples.length > 1) {
                return examples.map((ex, idx) => `(${idx + 1}) ${ex}`).join('\n');
            }
            return exampleText;
        }

        function showReviewCard() {
            const container = document.getElementById('reviewContainer');
            const word = appState.todayReviews[appState.currentReviewIndex];
            
            if (!word) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ‰</div>
                        <h3>${t('reviewComplete')}</h3>
                        <p>${t('reviewCompleteDesc')}</p>
                    </div>
                `;
                updateStats();
                return;
            }

            const examplesHtml = formatExamples(word.example);

            container.innerHTML = `
                <div class="review-card">
                    <div class="review-word">
                        ${word.word}
                        <button class="review-speak-btn" onclick="speakWord('${word.word}')">ğŸ”Š</button>
                    </div>
                    ${word.pos ? `<div style="color: var(--text-tertiary); margin-bottom: 15px;">${word.pos}</div>` : ''}
                    <div id="answerSection" class="hidden">
                        <div class="review-meaning">
                            <strong>${t('chinese')}ï¼š</strong>${word.meaning}
                            ${word.enMeaning ? `<br><strong>${t('english')}ï¼š</strong>${word.enMeaning}` : ''}
                        </div>
                        ${examplesHtml ? `<div class="review-example">${examplesHtml}</div>` : ''}
                        <div class="review-buttons">
                            <button class="review-btn btn-hard" onclick="reviewWord('hard')">${t('notFamiliar')}</button>
                            <button class="review-btn btn-medium" onclick="reviewWord('medium')">${t('somewhatFamiliar')}</button>
                            <button class="review-btn btn-easy" onclick="reviewWord('easy')">${t('veryFamiliar')}</button>
                        </div>
                    </div>
                    <button class="show-answer-btn" onclick="showAnswer()">${t('showAnswer')}</button>
                </div>
                <div style="text-align: center; color: var(--text-tertiary); margin-top: 10px;">
                    ${appState.currentReviewIndex + 1} / ${appState.todayReviews.length}
                </div>
            `;
        }

        function showAnswer() {
            document.getElementById('answerSection').classList.remove('hidden');
            document.querySelector('.show-answer-btn').classList.add('hidden');
        }

        function reviewWord(level) {
            const word = appState.todayReviews[appState.currentReviewIndex];
            const wordIndex = appState.words.findIndex(w => w.id === word.id);
            
            appState.words[wordIndex].level = level;
            appState.words[wordIndex].reviewCount++;
            
            const nextReviewDate = new Date();
            nextReviewDate.setDate(nextReviewDate.getDate() + REVIEW_INTERVALS[level]);
            appState.words[wordIndex].nextReview = nextReviewDate.toISOString().split('T')[0];
            
            saveLocalData();
            
            appState.currentReviewIndex++;
            showReviewCard();
        }

        function updateLibraryPage() {
            const container = document.getElementById('wordList');
            
            if (appState.words.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“–</div>
                        <h3>${t('noWords')}</h3>
                        <p>${t('noWordsDesc')}</p>
                    </div>
                `;
                return;
            }

            let words = [...appState.words];
            
            if (appState.searchQuery) {
                words = words.filter(word => 
                    word.word.toLowerCase().includes(appState.searchQuery) ||
                    word.meaning.toLowerCase().includes(appState.searchQuery) ||
                    (word.enMeaning && word.enMeaning.toLowerCase().includes(appState.searchQuery)) ||
                    (word.pos && word.pos.toLowerCase().includes(appState.searchQuery))
                );
            }

            const sortedWords = words.sort((a, b) => 
                new Date(b.createdAt) - new Date(a.createdAt)
            );

            if (sortedWords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ”</div>
                        <h3>${currentLang === 'zh-TW' ? 'æ²’æœ‰æ‰¾åˆ°å–®è©' : 'No words found'}</h3>
                        <p>${currentLang === 'zh-TW' ? 'è©¦è©¦å…¶ä»–æœç´¢è©' : 'Try different search terms'}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = sortedWords.map(word => `
                <div class="word-item" onclick="showWordDetail(${word.id})">
                    <div class="word-title">
                        <span>${word.word}</span>
                        <button class="speak-btn" onclick="event.stopPropagation(); speakWord('${word.word}')">ğŸ”Š</button>
                        ${word.pos ? `<span class="word-pos">${word.pos}</span>` : ''}
                    </div>
                    <div class="word-meaning">${word.meaning}</div>
                    <div class="word-meta">
                        <span class="word-level level-${word.level}">${getLevelText(word.level)}</span>
                        <span class="word-next-review">${t('nextReview')}: ${word.nextReview}</span>
                    </div>
                </div>
            `).join('');
        }

        function showWordDetail(wordId) {
            const word = appState.words.find(w => w.id === wordId);
            if (!word) return;

            const modal = document.getElementById('wordDetailModal');
            const content = document.getElementById('modalContent');
            
            const examplesHtml = formatExamples(word.example);
            
            content.innerHTML = `
                <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    ${word.word}
                    <button class="speak-btn" onclick="speakWord('${word.word}')">ğŸ”Š</button>
                    ${word.pos ? `<span class="word-pos">${word.pos}</span>` : ''}
                </h2>
                <div class="form-group">
                    <label class="form-label">${t('chineseMeaning')}</label>
                    <div>${word.meaning}</div>
                </div>
                ${word.enMeaning ? `
                <div class="form-group">
                    <label class="form-label">${t('englishMeaning')}</label>
                    <div>${word.enMeaning}</div>
                </div>
                ` : ''}
                ${examplesHtml ? `
                <div class="form-group">
                    <label class="form-label">${t('examples')}</label>
                    <div style="font-style: italic; white-space: pre-line; background: var(--input-bg); padding: 15px; border-radius: 10px; line-height: 1.8;">${examplesHtml}</div>
                </div>
                ` : ''}
                <div class="form-group">
                    <label class="form-label">${t('statistics')}</label>
                    <div>${t('reviewCount')}: ${word.reviewCount}</div>
                    <div>${t('proficiency')}: ${getLevelText(word.level)}</div>
                    <div>${t('nextReview')}: ${word.nextReview}</div>
                </div>
                <div class="modal-actions">
                    <button class="btn edit-btn" onclick="editWord(${word.id})">${t('editWord')}</button>
                    <button class="btn delete-btn" onclick="deleteWord(${word.id})">${t('deleteWord')}</button>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function editWord(wordId) {
            const word = appState.words.find(w => w.id === wordId);
            if (!word) return;

            editingWordId = wordId;
            
            const content = document.getElementById('modalContent');
            content.innerHTML = `
                <h2 style="margin-bottom: 20px;">${t('editWord')}</h2>
                <form id="editWordForm">
                    <div class="form-group">
                        <label class="form-label">${t('englishWord')}</label>
                        <input type="text" class="form-input" id="editWordInput" value="${word.word}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${t('partOfSpeech')}</label>
                        <input type="text" class="form-input" id="editPosInput" value="${word.pos || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">${t('chineseMeaning')}</label>
                        <input type="text" class="form-input" id="editMeaningInput" value="${word.meaning}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${t('englishMeaning')}</label>
                        <input type="text" class="form-input" id="editEnMeaningInput" value="${word.enMeaning || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">${t('examples')}</label>
                        <textarea class="form-textarea" id="editExampleInput">${word.example || ''}</textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel-btn" onclick="showWordDetail(${wordId})">${t('cancel')}</button>
                        <button type="submit" class="btn save-btn">${t('save')}</button>
                    </div>
                </form>
            `;

            document.getElementById('editWordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEditedWord();
            });
        }

        function saveEditedWord() {
            const wordIndex = appState.words.findIndex(w => w.id === editingWordId);
            if (wordIndex === -1) return;

            appState.words[wordIndex].word = document.getElementById('editWordInput').value.trim();
            appState.words[wordIndex].pos = document.getElementById('editPosInput').value.trim();
            appState.words[wordIndex].meaning = document.getElementById('editMeaningInput').value.trim();
            appState.words[wordIndex].enMeaning = document.getElementById('editEnMeaningInput').value.trim();
            appState.words[wordIndex].example = document.getElementById('editExampleInput').value.trim();

            saveLocalData();
            showWordDetail(editingWordId);
            updateLibraryPage();
            
            setTimeout(() => {
                const modal = document.getElementById('wordDetailModal');
                const statusDiv = document.createElement('div');
                statusDiv.className = 'sync-status';
                statusDiv.textContent = t('wordUpdated');
                modal.querySelector('.modal-content').appendChild(statusDiv);
                setTimeout(() => statusDiv.remove(), 3000);
            }, 100);
        }

        function closeModal() {
            document.getElementById('wordDetailModal').classList.remove('active');
            editingWordId = null;
        }

        function deleteWord(wordId) {
            if (confirm(t('confirmDelete'))) {
                appState.words = appState.words.filter(w => w.id !== wordId);
                saveLocalData();
                closeModal();
                updateLibraryPage();
                updateUI();
            }
        }

        function getLevelText(level) {
            const texts = {
                new: t('newWord'),
                hard: t('unfamiliar'),
                medium: t('medium'),
                easy: t('familiar')
            };
            return texts[level] || level;
        }

        function updateStatsPage() {
            const stats = {
                hard: appState.words.filter(w => w.level === 'hard').length,
                medium: appState.words.filter(w => w.level === 'medium').length,
                easy: appState.words.filter(w => w.level === 'easy').length
            };

            document.getElementById('hardCount').textContent = stats.hard;
            document.getElementById('mediumCount').textContent = stats.medium;
            document.getElementById('easyCount').textContent = stats.easy;
        }

        function saveSettings() {
            appState.settings.userId = document.getElementById('userIdInput').value.trim();
            appState.settings.token = document.getElementById('tokenInput').value.trim();
            appState.settings.repo = document.getElementById('repoInput').value.trim();
            appState.settings.folder = document.getElementById('folderInput').value.trim();
            appState.settings.language = currentLang;
            
            saveLocalData();
            showStatus('settingsStatus', t('settingsSaved'));
        }

        async function syncToGitHub() {
            const { userId, token, repo, folder } = appState.settings;
            
            if (!userId || !token || !repo) {
                alert(t('configureGithub'));
                switchPage('settingsPage');
                return;
            }

            try {
                const fileName = folder ? `${folder}/${userId}.json` : `${userId}.json`;
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(appState.words, null, 2))));
                
                let sha = '';
                try {
                    const getResponse = await fetch(`https://api.github.com/repos/${repo}/contents/${fileName}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    if (getResponse.ok) {
                        const data = await getResponse.json();
                        sha = data.sha;
                    }
                } catch (e) {}

                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${fileName}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Update ${userId} word list - ${new Date().toLocaleString()}`,
                        content: content,
                        sha: sha || undefined
                    })
                });

                if (response.ok) {
                    appState.settings.lastSync = new Date().toISOString();
                    saveLocalData();
                    updateSyncIndicator();
                    updateLastSyncTime();
                    alert(t('syncSuccess'));
                } else {
                    const error = await response.json();
                    alert(t('syncFailed') + (error.message || ''));
                }
            } catch (error) {
                alert(t('syncFailed') + error.message);
            }
        }

        async function downloadFromGitHub() {
            const { userId, token, repo, folder } = appState.settings;
            
            if (!userId || !token || !repo) {
                alert(t('configureGithubFirst'));
                return;
            }

            try {
                const fileName = folder ? `${folder}/${userId}.json` : `${userId}.json`;
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${fileName}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const content = decodeURIComponent(escape(atob(data.content)));
                    appState.words = JSON.parse(content);
                    appState.settings.lastSync = new Date().toISOString();
                    saveLocalData();
                    updateUI();
                    updateSyncIndicator();
                    updateLastSyncTime();
                    alert(t('downloadSuccess'));
                    switchPage('homePage');
                } else {
                    alert(t('downloadFailed') + t('downloadNotFound'));
                }
            } catch (error) {
                alert(t('downloadFailed') + error.message);
            }
        }

        function showStatus(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
            setTimeout(() => {
                element.classList.add('hidden');
            }, 3000);
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
            setTimeout(() => {
                element.classList.add('hidden');
            }, 5000);
        }

        initApp();
    </script>
</body>
</html>
